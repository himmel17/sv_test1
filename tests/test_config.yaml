# SystemVerilog Test Configuration
# This file defines all testbenches for the project
#
# =============================================================================
# Timescale Handling (Automatic Detection Only)
# =============================================================================
# The framework automatically detects timescale from testbench files and
# correctly converts sim_timeout to appropriate time units.
#
# Key Features:
# - Auto-detection: Reads `timescale directive from testbench .sv file
# - Correct conversion: "50us" timeout converted to proper time units based on detected timescale
#   Example: With `timescale 1ns/1ps: "50us" → 50000 time units
#   Example: With `timescale 1ps/1fs: "50us" → 50000000 time units
# - Validation: Warns if RTL files have different timescales than testbench
# - Best practice: Ensure all files in a test use the same timescale to avoid confusion
#
# Timescale Guidelines by Design Domain:
# - Low-speed (<1 GHz):    Use `timescale 1ns/1ps   (e.g., counters, control logic)
# - High-speed (10-25 Gbps): Use `timescale 1ps/1fs   (e.g., SerDes FFE/DFE/CTLE)
# - Ultra-high (>25 Gbps):   Use `timescale 100fs/1fs (rarely needed)
#
# =============================================================================

project:
  rtl_dir: rtl
  tb_dir: tb
  sim_dir: sim
  obj_dir: sim/obj_dir
  vcs_dir: sim/vcs  # VCS-specific artifacts directory
  waves_dir: sim/waves
  default_simulator: verilator  # Global default: verilator or vcs

# Simulator-specific configurations
simulators:
  verilator:
    common_flags:
      - --binary
      - --timing
      - -Wall
      - --trace
      - -Wno-TIMESCALEMOD
    execution_timeout: "30s"  # Real-world execution timeout (Verilator freeze protection)

  vcs:
    common_flags:
      - -sverilog
      - -timescale=1ns/1ps
      - -debug_access+all
      - +vcs+lic+wait
      - -full64
    execution_timeout: "30s"  # Real-world execution timeout (VCS freeze protection)

tests:
  # 8-bit counter test
  - name: counter
    enabled: true
    description: "8-bit synchronous counter with overflow detection"
    top_module: counter_tb
    testbench_file: counter_tb.sv
    rtl_files:
      - counter.sv
    verilator_extra_flags: []
    sim_timeout: "50us"  # Simulation timeout (passed to testbench via -GSIM_TIMEOUT)

  # 4-bit 1:4 demultiplexer test
  - name: demux_4bit
    enabled: true
    description: "4-bit 1:4 demultiplexer"
    top_module: demux_4bit_tb
    testbench_file: demux_4bit_tb.sv
    rtl_files:
      - demux_4bit.sv
    verilator_extra_flags: []
    sim_timeout: "10us"  # Simulation timeout (passed to testbench via -GSIM_TIMEOUT)

  # DPI-C sine wave generator (educational example)
  - name: sine_wave_gen
    enabled: true
    description: "DPI-C sine wave generator - educational example demonstrating SystemVerilog-C integration"
    top_module: sine_wave_gen_tb
    testbench_file: sine_wave_gen_tb.sv
    rtl_files:
      - sine_wave_gen.sv
    verilator_extra_flags:
      - ../dpi/dpi_math.c  # DPI-C C source file
      - -LDFLAGS            # Linker flags follow
      - -lm                 # Link math library for sin() function
    sim_timeout: "50us"  # Simulation timeout (passed to testbench via -GSIM_TIMEOUT)

  # Ideal amplifier with flicker noise (DPI-C PoC)
  - name: ideal_amp_with_noise
    enabled: true
    description: "Ideal amplifier with flicker (1/f) noise injection via DPI-C - Proof of Concept"
    top_module: ideal_amp_with_noise_tb
    testbench_file: ideal_amp_with_noise_tb.sv
    rtl_files:
      - ideal_amp_with_noise.sv
    verilator_extra_flags:
      - ../dpi/dpi_flicker_noise.c  # DPI-C flicker noise generator
    sim_timeout: "15us"  # Simulation timeout (1024 samples @ 100MHz = 10.24us + margin)

  # Ideal amplifier with flicker noise - BATCH MODE (Method 2 PoC)
  - name: ideal_amp_with_noise_batch
    enabled: true
    description: "Batch flicker noise: 4096 samples pre-loaded from Python binary (Method 2)"
    top_module: ideal_amp_with_noise_batch_tb
    testbench_file: ideal_amp_with_noise_batch_tb.sv
    rtl_files:
      - ideal_amp_with_noise.sv  # Reuse streaming RTL
    verilator_extra_flags:
      - ../dpi/dpi_flicker_noise_batch.c  # Batch DPI-C implementation
    sim_timeout: "50us"  # 4096 samples @ 100MHz = 40.96us + margin

  # SerDes Transmitter (template - uncomment when ready)
  # - name: serdes_tx
  #   enabled: true
  #   description: "SerDes transmitter module"
  #   top_module: serdes_tx_tb
  #   testbench_file: serdes_tx_tb.sv
  #   rtl_files:
  #     - serdes_tx.sv
  #     - serializer.sv
  #   verilator_extra_flags:
  #     - --trace-underscore
  #   sim_timeout: "100us"  # Simulation timeout (auto-detects timescale from testbench)

  # SerDes Receiver (template - uncomment when ready)
  # - name: serdes_rx
  #   enabled: true
  #   description: "SerDes receiver module"
  #   top_module: serdes_rx_tb
  #   testbench_file: serdes_rx_tb.sv
  #   rtl_files:
  #     - serdes_rx.sv
  #     - deserializer.sv
  #   verilator_extra_flags: []
  #   sim_timeout: "100us"  # Simulation timeout

  # Full SerDes Integration Test (template - uncomment when ready)
  # - name: serdes_full
  #   enabled: true
  #   description: "Full SerDes TX-RX integration test"
  #   top_module: serdes_full_tb
  #   testbench_file: serdes_full_tb.sv
  #   rtl_files:
  #     - serdes_tx.sv
  #     - serdes_rx.sv
  #     - serializer.sv
  #     - deserializer.sv
  #     - serdes_common.sv
  #   verilator_extra_flags:
  #     - --trace-depth
  #     - "2"
  #   sim_timeout: "200us"  # Simulation timeout
